<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ°çƒä»ªæµ‹è¯•</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a2e;
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    h1 {
      color: white;
      text-align: center;
    }
    
    #globe-container {
      width: 100%;
      height: 600px;
      margin: 2rem auto;
      max-width: 1200px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      background: linear-gradient(to bottom, #000428, #004e92);
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ äº¤äº’å¼åœ°çƒä»ªæµ‹è¯•</h1>
  <div id="globe-container" style="position: relative;">
    <div id="loading">æ­£åœ¨åŠ è½½åœ°çƒä»ª...</div>
  </div>

  <script type="module">
    // ç›´æ¥ä½¿ç”¨ CDN
    import Globe from 'https://cdn.skypack.dev/globe.gl';

    // è¶³è¿¹æ•°æ®
    const footprints = [
      { lat: 29.2685, lng: 117.1786, name: 'æ™¯å¾·é•‡', year: 2024, color: '#ff6b6b', size: 0.5 },
      { lat: 24.4798, lng: 118.0894, name: 'å¦é—¨', year: 2024, color: '#4ecdc4', size: 0.5 },
      { lat: 39.9042, lng: 116.4074, name: 'åŒ—äº¬', year: 2024, color: '#45b7d1', size: 0.5 },
      { lat: 22.5431, lng: 114.0579, name: 'æ·±åœ³', year: 2023, color: '#96ceb4', size: 0.5 },
      { lat: 22.3193, lng: 114.1694, name: 'é¦™æ¸¯', year: 2023, color: '#ffeaa7', size: 0.5 },
      { lat: 22.1987, lng: 113.5439, name: 'æ¾³é—¨', year: 2023, color: '#dfe6e9', size: 0.5 },
      { lat: 25.0917, lng: 117.0172, name: 'é¾™å²©', year: 2023, color: '#74b9ff', size: 0.5 },
      { lat: 24.8736, lng: 118.6757, name: 'æ³‰å·', year: 2022, color: '#a29bfe', size: 0.5 },
      { lat: 24.5130, lng: 117.6471, name: 'æ¼³å·', year: 2022, color: '#fd79a8', size: 0.5 },
      { lat: 23.0515, lng: 112.4653, name: 'è‚‡åº†', year: 2022, color: '#fdcb6e', size: 0.5 },
      { lat: 35.6762, lng: 139.6503, name: 'ä¸œäº¬', year: 2023, color: '#e17055', size: 0.5 },
      { lat: 34.6937, lng: 135.5023, name: 'å¤§é˜ª', year: 2023, color: '#00b894', size: 0.5 },
      { lat: 35.0116, lng: 135.7681, name: 'äº¬éƒ½', year: 2023, color: '#00cec9', size: 0.5 },
      { lat: 34.6851, lng: 135.8048, name: 'å¥ˆè‰¯', year: 2023, color: '#6c5ce7', size: 0.5 },
    ];

    // è¿æ¥çº¿æ•°æ®
    const arcs = [
      { startLat: 29.2685, startLng: 117.1786, endLat: 24.4798, endLng: 118.0894 },
      { startLat: 24.4798, startLng: 118.0894, endLat: 39.9042, endLng: 116.4074 },
      { startLat: 39.9042, startLng: 116.4074, endLat: 22.5431, endLng: 114.0579 },
      { startLat: 22.5431, startLng: 114.0579, endLat: 22.3193, endLng: 114.1694 },
      { startLat: 22.3193, startLng: 114.1694, endLat: 35.6762, endLng: 139.6503 },
    ];

    try {
      const container = document.getElementById('globe-container');
      const loading = document.getElementById('loading');
      
      console.log('å¼€å§‹åˆå§‹åŒ–åœ°çƒä»ª...');
      
      const globe = Globe()(container)
        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
        .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
        .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
        
        // æ·»åŠ è¶³è¿¹ç‚¹
        .pointsData(footprints)
        .pointAltitude('size')
        .pointColor('color')
        .pointRadius(0.5)
        .pointLabel((d) => `
          <div style="
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            color: white;
          ">
            <strong>${d.name}</strong><br/>
            <span style="opacity: 0.8;">${d.year}</span>
          </div>
        `)
        
        // æ·»åŠ è¿æ¥çº¿
        .arcsData(arcs)
        .arcColor(() => 'rgba(255, 255, 255, 0.5)')
        .arcDashLength(0.4)
        .arcDashGap(0.2)
        .arcDashAnimateTime(2000)
        .arcStroke(0.5)
        
        // æ·»åŠ å…‰æ™•æ•ˆæœ
        .atmosphereColor('lightskyblue')
        .atmosphereAltitude(0.15)
        
        // æ§åˆ¶è®¾ç½®
        .enablePointerInteraction(true);

      // ç¦ç”¨è‡ªåŠ¨æ—‹è½¬
      globe.controls().autoRotate = false;
      globe.controls().autoRotateSpeed = 0;
      globe.controls().enableZoom = true;
      globe.controls().enableRotate = true; // å…è®¸æ‰‹åŠ¨æ—‹è½¬
      globe.controls().enablePan = true; // å…è®¸å¹³ç§»
      
      // ä¼˜åŒ–ç¼©æ”¾è®¾ç½®
      globe.controls().zoomSpeed = 2; // å¢åŠ ç¼©æ”¾é€Ÿåº¦ï¼ˆé»˜è®¤æ˜¯1ï¼‰
      globe.controls().minDistance = 101; // æœ€å°è·ç¦»ï¼ˆå¯ä»¥æ”¾å¤§åˆ°å¾ˆè¿‘ï¼‰
      globe.controls().maxDistance = 1000; // æœ€å¤§è·ç¦»ï¼ˆå¯ä»¥ç¼©å°åˆ°å¾ˆè¿œï¼‰
      globe.controls().enableDamping = true; // å¯ç”¨é˜»å°¼ï¼ˆæ›´æµç•…ï¼‰
      globe.controls().dampingFactor = 0.1; // é˜»å°¼ç³»æ•°

      // è‡ªå®šä¹‰æ»šè½®ç¼©æ”¾å¤„ç†
      let currentAltitude = 2;
      container.addEventListener('wheel', (event) => {
        event.preventDefault();
        const delta = event.deltaY;
        // æ ¹æ®æ»šè½®æ–¹å‘è°ƒæ•´é«˜åº¦
        currentAltitude += delta * 0.001;
        // é™åˆ¶é«˜åº¦èŒƒå›´
        currentAltitude = Math.max(0.5, Math.min(10, currentAltitude));
        
        // è·å–å½“å‰è§†è§’
        const pov = globe.pointOfView();
        globe.pointOfView({ 
          lat: pov.lat, 
          lng: pov.lng, 
          altitude: currentAltitude 
        }, 0); // å³æ—¶å“åº”ï¼Œä¸è¦åŠ¨ç”»
      }, { passive: false });

      // è®¾ç½®åˆå§‹è§†è§’ - èšç„¦åœ¨å¦é—¨
      globe.pointOfView({ lat: 24.4798, lng: 118.0894, altitude: 2 }, 1000);

      // å“åº”å¼å¤„ç†
      const handleResize = () => {
        globe.width(container.offsetWidth);
        globe.height(container.offsetHeight);
      };
      
      window.addEventListener('resize', handleResize);
      setTimeout(handleResize, 100);

      // æ·»åŠ ç‚¹å‡»äº¤äº’
      globe.onPointClick((point) => {
        globe.pointOfView({
          lat: point.lat,
          lng: point.lng,
          altitude: 1.5
        }, 1000);
      });

      // ç§»é™¤åŠ è½½æç¤º
      setTimeout(() => {
        if (loading) loading.style.display = 'none';
      }, 2000);

      console.log('åœ°çƒä»ªåˆå§‹åŒ–æˆåŠŸï¼');
    } catch (error) {
      console.error('åœ°çƒä»ªåŠ è½½å¤±è´¥:', error);
      document.getElementById('globe-container').innerHTML = `
        <div style="
          display: flex;
          align-items: center;
          justify-content: center;
          height: 100%;
          color: white;
          text-align: center;
          padding: 2rem;
        ">
          <div>
            <p style="font-size: 1.5rem; margin-bottom: 1rem;">ğŸ˜…</p>
            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">åœ°çƒä»ªåŠ è½½å¤±è´¥</p>
            <p style="opacity: 0.7;">é”™è¯¯: ${error.message}</p>
            <p style="opacity: 0.7; margin-top: 1rem;">è¯·æ£€æŸ¥æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
